{% extends "base.html" %}

{% block conteudo %}
<div class="container" style="max-width: 600px;">
    <h2 class="mb-4 text-center">Novo Lan√ßamento</h2>
    
    <div class="card shadow">
        <div class="card-body">
            <form action="{{ url_for('financeiro.novo') }}" method="POST">
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">Tipo de Opera√ß√£o</label>
                        <select class="form-select" name="tipo" id="tipo" required onchange="atualizarCategorias()">
                            <option value="entrada" selected>üü¢ Entrada (Receita)</option>
                            <option value="saida">üî¥ Sa√≠da (Despesa)</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label fw-bold">Data</label>
                        <input type="date" class="form-control" name="data" value="{{ hoje }}" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Categoria</label>
                    <input type="text" class="form-control" name="categoria" id="categoria" list="lista-categorias" placeholder="Ex: D√≠zimo, Oferta, Aluguel..." required>
                    <datalist id="lista-categorias">
                        </datalist>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Valor (R$)</label>
                    <div class="input-group">
                        <span class="input-group-text">R$</span>
                        <input type="number" step="0.01" class="form-control" name="valor" placeholder="0,00" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Descri√ß√£o (Opcional)</label>
                    <input type="text" class="form-control" name="descricao" placeholder="Detalhes adicionais...">
                </div>

                <div class="mb-4 p-3 bg-light rounded border">
                    <label class="form-label fw-bold small text-muted text-uppercase">Vincular Membro (Para D√≠zimos)</label>
                    <select class="form-select" name="membro_id">
                        <option value="">-- Lan√ßamento An√¥nimo / Sem V√≠nculo --</option>
                        {% for membro in membros %}
                            <option value="{{ membro.id }}">{{ membro.nome }} (CPF: {{ membro.cpf }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success fw-bold">üí∞ Registrar Lan√ßamento</button>
                    <a href="{{ url_for('financeiro.index') }}" class="btn btn-secondary">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function atualizarCategorias() {
        const tipo = document.getElementById('tipo').value;
        const datalist = document.getElementById('lista-categorias');
        datalist.innerHTML = ''; // Limpa op√ß√µes

        let opcoes = [];
        if (tipo === 'entrada') {
            opcoes = ['D√≠zimo', 'Oferta', 'Oferta Miss√µes', 'Doa√ß√£o Espec√≠fica', 'Venda Cantina'];
        } else {
            opcoes = ['Aluguel', 'Energia El√©trica', '√Ågua', 'Internet', 'Material Limpeza', 'Ajuda Social', 'Sal√°rio Pastoral', 'Manuten√ß√£o'];
        }

        opcoes.forEach(op => {
            const option = document.createElement('option');
            option.value = op;
            datalist.appendChild(option);
        });
    }

    // Inicia a lista correta
    window.onload = atualizarCategorias;
</script>
{% endblock %}